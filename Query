SELECT 
    E2.ENAME AS Manager_Name
FROM 
    EMPLOYEE E1
JOIN 
    EMPLOYEE E2 
ON 
    E1.MGR_NO = E2.EMPNO
GROUP BY 
    E2.ENAME
HAVING 
    COUNT(E1.EMPNO) = (
        SELECT MAX(EmployeeCount)
        FROM (
            SELECT COUNT(E1.EMPNO) AS EmployeeCount
            FROM EMPLOYEE E1
            WHERE E1.MGR_NO IS NOT NULL
            GROUP BY E1.MGR_NO
        ) AS SubQuery
    );


SELECT 
    M.ENAME AS Manager_Name, 
    M.SAL AS Manager_Salary
FROM 
    EMPLOYEE M
WHERE 
    M.EMPNO IN (SELECT DISTINCT MGR_NO FROM EMPLOYEE WHERE MGR_NO IS NOT NULL)
    AND M.SAL > (
        SELECT AVG(E.SAL)
        FROM EMPLOYEE E
        WHERE E.MGR_NO = M.EMPNO
    );

SELECT 
    E.ENAME AS Second_Level_Manager,
    D.DNAME AS Department_Name
FROM 
    EMPLOYEE E
JOIN 
    DEPT D ON E.DEPTNO = D.DEPTNO
WHERE 
    E.MGR_NO IN (
        SELECT EMPNO FROM EMPLOYEE WHERE MGR_NO IS NULL
    );

SELECT *
FROM INCENTIVES I
JOIN EMPLOYEE E ON I.EMPNO = E.EMPNO
WHERE MONTH(I.INCENTIVE_DATE) = 1 
  AND YEAR(I.INCENTIVE_DATE) = 2019
ORDER BY I.INCENTIVE_AMOUNT DESC
LIMIT 1 OFFSET 1;

SELECT 
    E.ENAME AS Employee_Name,
    M.ENAME AS Manager_Name,
    D.DNAME AS Department
FROM 
    EMPLOYEE E
JOIN 
    EMPLOYEE M ON E.MGR_NO = M.EMPNO
JOIN 
    DEPT D ON E.DEPTNO = D.DEPTNO
WHERE 
    E.DEPTNO = M.DEPTNO;


